<?xml version="1.0" encoding="UTF-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
	<id value="ch-alis-message" />
	<url value="http://fhir.ch/ig/ch-alis/StructureDefinition/ch-alis-message" />
	<version value="0.1.0" />
	<name value="ChAlisMessage" />
	<title value="CH ALIS Message Profile" />
	<status value="draft" />
	<date value="2020-11-26" />
	<publisher value="ALIS-Connect" />
	<contact>
		<name value="ALIS-Connect" />
		<telecom>
			<system value="url" />
			<value value="https://www.alis-connect.ch/" />
		</telecom>
	</contact>
	<description value="Base definition for the Bundle resource in the context of ALIS-Connect." />
	<jurisdiction>
		<coding>
			<system value="urn:iso:std:iso:3166" />
			<code value="CH" />
		</coding>
	</jurisdiction>
	<fhirVersion value="4.0.1" />
	<mapping>
		<identity value="alis"/>
		<name value="Zertifizierungsdokument ALIS-Connect"/>
		<comment value="Zertifizierung ALIS V4.3_2020"/>
	</mapping>
	<kind value="resource" />
	<abstract value="false" />
	<type value="Bundle" />
	<baseDefinition value="http://hl7.org/fhir/StructureDefinition/Bundle" />
	<derivation value="constraint" />
	<differential>
		<element id="Bundle">
			<path value="Bundle"/>
			<short value="CH ALIS Message"/>
			<mapping>
				<identity value="alis"/>
				<map value="Header"/>
			</mapping>
		</element>
		<element id="Bundle.type">
			<path value="Bundle.type" />
			<short value="message" />
			<fixedCode value="message" />
		</element>
		<!-- 1.10 Fileerstellungsdatum (FileCreationDate) -->
		<element id="Bundle.timestamp">
			<path value="Bundle.timestamp" />
			<short value="FileCreationDate" />
			<mapping>
				<identity value="alis"/>
				<map value="FileCreationDate"/>
			</mapping>
		</element>
		<element id="Bundle.entry">
			<path value="Bundle.entry" />
			<slicing>
				<discriminator>
					<type value="profile" />
					<path value="resource" />
				</discriminator>
				<rules value="open" />
			</slicing>
			<min value="2"/>
		</element>

		<element id="Bundle.entry:MessageHeader">
			<path value="Bundle.entry" />
			<sliceName value="MessageHeader" />
			<short value="MessageHeader" />
			<min value="1" />
			<max value="1" />
		</element>
		<element id="Bundle.entry:MessageHeader.fullUrl">
			<path value="Bundle.entry.fullUrl"/>
			<min value="1"/>
			<constraint>
				<key value="ch-alis-message-1"/>
				<severity value="error"/>
				<human value="The fullUrl for the MessageHeader as first entry must be an absolute URL server address"/>
				<expression value="startsWith('http') = true"/>
			</constraint>
		</element>
		<element id="Bundle.entry:MessageHeader.resource">
			<path value="Bundle.entry.resource" />
			<min value="1" />
			<type>
				<code value="Resource" />
				<profile value="http://fhir.ch/ig/ch-alis/StructureDefinition/ch-alis-messageheader" />
			</type>
		</element>

		<element id="Bundle.entry:Transaction">
			<path value="Bundle.entry" />
			<sliceName value="Transaction" />
			<short value="Transaction" />
			<min value="1" />
			<max value="1" />
		</element>
		<element id="Bundle.entry:Transaction.fullUrl">
			<path value="Bundle.entry.fullUrl"/>
			<min value="1"/>
			<constraint>
				<key value="ch-alis-message-2"/>
				<severity value="error"/>
				<human value="The fullUrl must be an absolute URL server address or an URI for UUID/OID"/>
				<expression value="startsWith('http') or startsWith('urn:uuid:') = true"/>
			</constraint>
		</element>
		<element id="Bundle.entry:Transaction.resource">
			<path value="Bundle.entry.resource" />
			<min value="1" />
			<type>
				<code value="Resource" />
				<profile value="http://fhir.ch/ig/ch-alis/StructureDefinition/ch-alis-transaction" />
			</type>
		</element>
	</differential>
</StructureDefinition>